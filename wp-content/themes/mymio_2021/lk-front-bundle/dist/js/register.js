!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=4)}([function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n=(e="body",t,a="active")=>{let n;n="string"==typeof e?$(e).find(".loader"):e.find(".loader"),n&&("show"!==t?n.hasClass(a)&&n.removeClass(a):n.addClass(a))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n=async(e,t)=>{const a={...{headers:{"Content-Type":"application/json","X-Token":"8657d620-f5eb-4552-997d-d3ec43688c29"}},...t};try{return await fetch(e,a)}catch(e){return!1}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return c})),a.d(t,"d",(function(){return o}));const n=homeUrl+"/custom_auth/",r=async(e,...t)=>{const a=Object.create({});Object.defineProperty(a,"user_data",{value:{},enumerable:!0,writable:!0}),t.forEach(e=>{const t=e.name,n=e.value||"";Object.defineProperty(a.user_data,t,{value:n,enumerable:!0,writable:!0})});const r=`${n}${e}.php`,i=new FormData;return i.set("user_data",JSON.stringify(a)),await(async(e="",t={})=>{try{return await fetch(e,{method:"POST",mode:"no-cors",body:t})}catch(e){return!1}})(r,i)},i=async(e,t)=>{const a={name:"user_email",value:e},n={name:"user_name",value:t};return await r("create-user",a,n)},s=async(e,t)=>{const a={name:"user_email",value:e},n={name:"elma_id",value:t};return await r("create-user-elma-id",a,n)},c=async e=>{const t={name:"user_email",value:e};return await r("delete-user",t)},o=async e=>{try{return await fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"},mode:"no-cors"})}catch(e){return!1}}},,function(e,t,a){"use strict";a.r(t);var n=a(1),r=a(2),i=a(0);if(registerEmail){new function(e){const t=this;this.email=e,this.modalWindow=document.querySelector(".modal--register"),this.checkUser=async()=>{try{const e=await Object(r.a)(this.email);return await e.json()}catch(e){return!1}},this.getElmaIdByEmail=async()=>{try{const t="https://aeqlmvgvlxcee.elma365.ru/api/extensions/3d15932c-766e-4e91-b8ff-fed442649de2/script/search_guardianship_by_email",a={method:"POST",body:JSON.stringify({context:{email:e}})},r=await Object(n.a)(t,a);return await r.json()}catch(e){return!1}},this.sendUserPasswordToElma=async(e,t)=>{try{const a=JSON.stringify({context:{id:e,password:t.user_pass}}),r="https://aeqlmvgvlxcee.elma365.ru/api/extensions/3d15932c-766e-4e91-b8ff-fed442649de2/script/old_base/appupdate",i={method:"POST",body:a},s=await Object(n.a)(r,i);return await s.json()}catch(e){return!1}},this.createNewUser=async e=>{try{return await Object(r.b)(this.email,e)}catch(e){return!1}},this.check=async()=>{const e=await this.checkUser();let t=!0;const a=new this.modal;if(await e.status){a.changeContent("Создание id пользователя...");const n=await this.getElmaIdByEmail();if(await n.id){a.changeContent("Создание учетной записи...");const r=await this.createNewUser(n.id),i=await this.sendUserPasswordToElma(n.id,e);await r&&await i?a.finish("Готово!"):(t=!1,a.finish("Ошибка сервера. Попробуйте позже."))}else t=!1,a.finish("Ошибка сервера. Попробуйте позже.")}else a.finish(`Пользователь с email "${this.email}" уже зарегистрирован.`);t||await Object(r.c)(this.email)},this.modal=function(){const e=t.modalWindow,a=e.querySelector(".modal--content"),n=e.querySelector(".modal--btn");this.changeContent=e=>{a.innerHTML=e},this.finish=t=>{this.changeContent(t),Object(i.a)(".modal--register"),n.classList.contains("hide")&&n.classList.remove("hide"),e.dataset.close="true",e.addEventListener("click",this.hideModal),window.history.pushState(null,document.title,window.location.pathname)},this.hideModal=function(e){e.preventDefault();e.target.dataset.close&&t.modalWindow.classList.remove("active")}},this.init=()=>{window.addEventListener("load",async()=>{await this.check()})}}(registerEmail).init()}}]);